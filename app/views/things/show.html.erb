<%- model_class = Thing -%>
<div class="page-header row-fluid">
  <h1 class="span8">
    <%= resource.name %> 
    <small>(#<%= resource.average_position %> of <%= Thing.count %> )</small>
  </h1>
  <div class="span4">
    <% if parent? %>
      <span class="label label-inverse">Average Position: <%= resource.average_position %></span>
    <% elsif signed_in? %>
      <span class="label label-inverse">Your Ranking: <%= resource.assigned_things.where{ user_id == my{current_user.id}}.first.position %></span>
    <% end %>
  </div>
</div>

<%= simple_form_for resource, :html => { :class => 'form-horizontal' } do |f| %>
  <%= f.input :tag_list %>
<% end %>

<h2>History</h2>

<table class="table table-striped table-hover table-condensed">
  <thead>
    <tr>
      <th>Average Rank</th>
      <th>Changed</th>
    </tr>
  </thead>
  <tbody>
    <% resource.versions.reorder{ created_at.desc }.each do |version| %>
      <% thing = YAML::load(version.object) rescue nil %>
      <% if thing %>
        <tr>
          <td class="count"><%= thing['average_position'].to_f %></td>
          <td><time class="convert"><%=l version.created_at %></time></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>

<% if can?(:update, resource) || can?(:destroy, resource) %>
  <div class="form-actions">
    <%= link_to t('.edit', :default => t("helpers.links.edit")),
                edit_thing_path(@thing), :class => 'btn' if can?(:update, resource) %>
    <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                thing_path(@thing),
                :method => 'delete',
                :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                :class => 'btn btn-danger' if can?(:destroy, resource) %>
  </div>
<% end %>